"0",""
"0","# function to calculate the mean of Motion - Scrambled across participants"
"0","get_M_minus_S <- function(df) {"
"0","  df %>% "
"0","    pivot_wider(names_from = contrast, values_from = isc) %>% "
"0","    mutate(M_minus_S = Motion - Scrambled) %>% "
"0","    select(M_minus_S)"
"0","}"
"0",""
"0",""
"0","# function to calculate standard error after removing NAs"
"0","sterr <- function(x) {"
"0","  x <- x[!is.na(x)]"
"0","  sd(x)/sqrt(length(x))"
"0","}"
"0",""
"0",""
"0","# prepare the Motion - Scrambled for each sub, its mean and sderr"
"0","res2plot <- res %>% "
"0","  mutate("
"0","    diff_MS = map(data, get_M_minus_S),"
"0","  ) %>% "
"0","  select(D_bins, JU, diff_MS,name,pcorr_sig) %>% "
"0","  unnest(diff_MS) %>% "
"0","  group_by(D_bins, JU) %>% "
"0","  mutate("
"0","    diff_mean = mean(M_minus_S, na.rm = T),"
"0","    diff_sterr = sterr(M_minus_S)"
"0","  )"
"0","  # # pipe the following to have a clearer view of res2plot"
"0","  # group_by(D_bins, JU, diff_mean,diff_sterr,name,pcorr_sig) %>% "
"0","  # nest()"
"0",""
"0",""
"0",""
"0","# plot mean difference Motion - Scrambled, and its variability across subs"
"0","fig <- res2plot %>% "
"0","  # unnest(data) %>% "
"0","  ggplot( aes(x = D_bins, y = diff_mean, fill = D_bins) ) +"
"0","  geom_bar(stat = ""identity"", position = position_identity(), alpha = 0.6) +"
"0","  # geom_linerange("
"0","  #   aes(ymin = diff_mean - diff_sterr, ymax = diff_mean + diff_sterr),"
"0","  #   color=""red"", alpha = 0.5"
"0","  # ) +"
"0","  scale_fill_gradient2_tableau() +"
"0","  geom_point("
"0","    aes(x = pcorr_sig, y = M_minus_S, fill = D_bins),"
"0","    shape = 21, size = 2,"
"0","    na.rm = T # to suppress the warning due to plotting only pcorr_sig cols"
"0","  ) + "
"0","    geom_linerange("
"0","    aes(ymin = diff_mean - diff_sterr, ymax = diff_mean + diff_sterr),"
"0","    color=""red"", alpha = 0.5"
"0","  ) +"
"0","  facet_wrap(~ name, scales = ""free"", labeller = label_wrap_gen(width=22)) +"
"0",""
"0","  theme_minimal() +"
"0","  labs("
"0","    title = ""Mean Motion - Scrambled ISC parameter estimates for each Depth bin in each Juelich region across participants"","
"0","    subtitle = ""Individual participants are plotted only for bins which show a (corrected) sig difference between Motion and Scrambled"""
"0","  ) +"
"0","  ylab(""Mean Motion - Scrambled ISC estimate across participants"") + "
"0","  xlab(""Cortical Depth bins :  1 = WM/GM border, 6 = pial"") +"
"0","  theme("
"0","    strip.text.x = element_text(size = 11), # increase size of title for each subplot"
"0","    panel.spacing.y = unit(3, ""lines"")      # increase space between facets"
"0","  ) +"
"0","  coord_flip(ylim = c(min(res2plot$diff_mean) - 0.05, max(res2plot$diff_mean) + 0.05))"
"0",""
"0",""
"0","fig"
